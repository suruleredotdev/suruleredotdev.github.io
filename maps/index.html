---
layout: default
---

<script>
    let title = "";
    function updateTitle(e) {
        title = e.target.innerText;
    }

    let code = "";
</script>

{% include map.html %}

<style>
    /* special animations on page load */
    @-webkit-keyframes moveLeft {
        0% {
            margin-left: calc(4 * var(--bg-size));
        }
        100% {
            margin-left: calc(2 * var(--bg-size));
        }
    }

    @-webkit-keyframes growToFillFrame {
        0% {
            margin-left: calc(4 * var(--bg-size));
        }
        100% {
            margin-left: calc(2 * var(--bg-size));
        }
    }

    @-webkit-keyframes scaleDown {
        0% { width: calc(2 * var(--bg-size)); }
        100% { width: var(--bg-size); }
    }

    @media screen and (min-width: 600px) {
        #logo img {
            animation: scaleDown ease 500ms;
            width: var(--bg-size);
            margin-left: calc(2 * var(--bg-size));
        }
    }

    .MAP {
        height: calc(12 * var(--bg-size));
    }

    @media screen and (min-width: 1200px) {
        .MAP {
            width: 100%;
        }
    }

    .title:empty {
        content: "Untitled";
    }

    #codemirror-error {
      display: none;
    }
  
</style>

<div id="content" class="map post pa3 pa5-ns mt6-l mh7-l f5">
    <div class="b f7 o-40 flex flex-column fw5 ba pa1 dib" style="width: fit-content">
        <span class="dib" style="width: fit-content">MAP </span>
        <span class="dib" style="width: fit-content">EDITOR</span>
    </div>

    <h1 class="title mb0 pb2" onchange="updateTitle" contenteditable="true">
        Untitled
    </h1>

    <div class="MAP-container flex flex-row">
        <div id="map" class="MAP"></div>
        
    </div>

    <div class="f7 o-40 fw5 bb pa1 pt2" style="width: fit-content">
        <span style="width: fit-content">SCRIPT EDITOR</span>
    </div>

    <div id="codemirror" class="mr3 mv2">// PREDEFINED GLOBAL VARIABLES: 
// `L` - leaflet library main object
// `map` - initialized Leaflet map object that's displayed, with Google maps tile layers as default
// `omnivore` - Leaflet plugin for loading geo data from various formats including KML, GeoJSON and CSV

// KML LAYERS
omnivore.kml("/maps/data/lagos-slums.kml").addTo(map);

// FUNCTIONS
function panOnClick(latlng) {
    map.panTo(latlng);
}

/*
    // TILE LAYERS
    L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3'],
        attribution: '<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
*/
    </div>

    <div id="codemirror-error" class="red f7 o-40 fw5 pa1 pt2 flex flex-row" style="width: fit-content">
        <span class="b" style="width: fit-content">ERROR: </span> 
        <span id="codemirror-error-msg">

        </span> 
    </div>

</div>

<script id="map-script">
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/codemirror.min.js" integrity="sha512-H5RyE1jRbGn8d0dsSstZi0SSs23X6Hkkf5hLneEIFyCfP/cBwJ/jFJESBuFBiUyzbGZGa06tnrvw1SboRKdwcA==" crossorigin="anonymous"></script>
<!--- CODEMIRROR imports -->
    <!-- lib -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/codemirror.min.css" integrity="sha512-/BlxZbYLtYGExexketXsTi47eHp+r2kTeq2OHecQPZlfbc7WFXVrwbVW9HOYjI6c9Ti+P60ASmVLxittZ0EBGw==" crossorigin="anonymous" />
    <!-- javascript mode -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/mode/javascript/javascript.min.js" integrity="sha512-9miXlEjnHTF+nVGdc2IGOLGTFW2wWkWbd1/7Ltlre+dM53ZSCUQ/PNN+jtsmYqr3ndiD5RW6XQJUm/Hz8JvyOQ==" crossorigin="anonymous"></script>
    <!-- dark theme -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/theme/material.min.css" integrity="sha512-t93jzyjNejvKJ0LbK+VuLVp89Y8olz3sMmGPhKXYsTjSLuu3a3dVaZljCK6g04ShmsANEM8xe/OB+IaBE2LRBA==" crossorigin="anonymous" />
    <!-- light theme -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/theme/neo.min.css" integrity="sha512-n6DpN0Uo6L9yIU4MeX5hhnCX6NejvEBxXQ2GNmBl8febWyt1Fdh7C4EiDQvBeGtFOaOIBxZAf/VQZjjUvs04ng==" crossorigin="anonymous" />
    <!-- light theme (alternate) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.56.0/theme/paraiso-light.min.css" integrity="sha512-xb7HM7Q7s3Lm0LSzMGAOkUYJR/7tDmIYf3nEpJ85LECOEehenge0dbpIJqW8mrxMLCcQzwU7N6y/R7TzGCu7iA==" crossorigin="anonymous" />

<script>
    let map = L.map('map').setView([6.498820462853738, 3.3958632487106137], 9);
    L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains:['mt0','mt1','mt2','mt3'],
    }).addTo(map);

    let el = document.getElementById("codemirror");
    let text = el.innerHTML; el.innerHTML = "";
    var codemirror = CodeMirror(el, {
        value: text,
        lineNumbers: true,
        mode:  "javascript",
        extraKeys: {
            "Ctrl-Space": "autocomplete" ,
            "Ctrl-Space":function(cm){  CodeMirror.showHint(cm, CodeMirror.hint.anyword); }, 
            "'.'" : function(cmm){ CodeMirror.showHint(cmm, CodeMirror.hint.anyword);},
        },
    });
    codemirror.on('change', function (cm) {
        L.marker([6.498, 3.3958]).addTo(map);
        code = cm.getValue();

        console.log("refreshing map-script");

        document.getElementById("map-script").remove();
        var script = document.createElement('script');
        script.id = "map-script"
        let wrappedScript = `
try {
    (function() {
        ${code}
    })();
    document.getElementById('codemirror-error').style.display = "none";
} catch (err) {
    document.getElementById('codemirror-error').style.display = "block";
    document.getElementById('codemirror-error-msg').textContent = err.message;
}
        `
        script.textContent = wrappedScript;
        document.body.appendChild(script);
    });
</script>